---
name: video_analysis
description: 视频处理和分析工具，使用 ffmpeg 将视频切片为图片，然后分析图片内容。
---

# 视频处理和分析工具

## 【核心功能】

使用 ffmpeg 将视频文件切片为图片帧，然后对图片进行分析，提取视频中的关键信息。

## 【工作流程】

1. **视频切片**：使用 ffmpeg 将视频按时间间隔提取为图片帧
2. **图片分析**：对提取的图片进行内容分析，识别关键信息
3. **结果汇总**：将多张图片的分析结果整合成完整的视频分析报告

## 【ffmpeg 命令使用】

### 基本命令格式

```bash
ffmpeg -i <输入视频文件> -vf fps=<帧率> -q:v <图片质量> <输出图片路径>
```

### 常用参数说明

- `-i <输入文件>`：指定输入视频文件路径
- `-vf fps=<帧率>`：设置提取帧率（如 `fps=1` 表示每秒提取1帧，`fps=1/10` 表示每10秒提取1帧）
- `-q:v <质量>`：设置图片质量（1-31，1为最高质量，建议使用2-5）
- `-ss <开始时间>`：从指定时间开始提取（格式：HH:MM:SS 或 秒数）
- `-t <持续时间>`：提取指定时长的视频（格式：HH:MM:SS 或 秒数）
- `-frames:v <帧数>`：提取指定数量的帧

### 常用命令示例

#### 1. 按固定间隔提取帧（推荐）

```bash
# 每10秒提取1帧，使用项目标准命名
ffmpeg -i input.mp4 -vf fps=1/10 -q:v 2 frames/vframe_%04d.jpg
```

#### 2. 提取特定时间段的帧

```bash
# 从第30秒开始，提取60秒的视频，每5秒1帧
ffmpeg -i input.mp4 -ss 00:00:30 -t 60 -vf fps=1/5 -q:v 2 frames/vframe_%04d.jpg
```

#### 3. 提取固定数量的帧

```bash
# 提取20帧，均匀分布在视频中
ffmpeg -i input.mp4 -vf "select='not(mod(n,100))',scale=1280:-1" -frames:v 20 frames/vframe_%04d.jpg
```

#### 4. 提取关键帧（I帧）

```bash
# 只提取关键帧，文件更小但可能不够均匀
ffmpeg -i input.mp4 -vf "select='eq(pict_type,I)'" -vsync vfr frames/vframe_%04d.jpg
```

### 输出文件命名（项目标准）

**标准格式**：使用 `vframe_` 前缀 + 4位序号

```bash
ffmpeg -i input.mp4 -vf fps=1/10 -q:v 2 vframe_%04d.jpg
```

**输出示例**：
- `vframe_0001.jpg`, `vframe_0002.jpg`, `vframe_0003.jpg` ...

**为什么使用 vframe_ 前缀？**
1. **语义清晰**：v=video, frame=帧，一目了然
2. **易于搜索**：`ls vframe_*` 或 `find . -name "vframe_*"` 快速定位
3. **避免冲突**：与通用命名（output_*.jpg, IMG_*.jpg）区分
4. **便于处理**：统一前缀方便批量操作和脚本处理

**其他格式**（不推荐）：
- `frame_%03d.jpg`：通用格式，容易与其他工具混淆
- `output_%d.jpg`：太通用，不便于识别来源

## 【执行步骤】

### 步骤1：准备输出目录

在执行 ffmpeg 命令前，先创建输出目录：

```bash
mkdir -p frames
```

### 步骤2：执行视频切片

选择合适的命令执行视频切片，建议：
- 短视频（<5分钟）：每5秒提取1帧（`fps=1/5`）
- 中等视频（5-30分钟）：每10秒提取1帧（`fps=1/10`）
- 长视频（>30分钟）：每30秒提取1帧（`fps=1/30`）

### 步骤3：分析图片

对提取的图片进行逐一分析：
- 识别图片中的主要内容
- 提取关键信息（文字、物体、场景等）
- 记录时间戳（根据文件名推断）

### 步骤4：汇总结果

将所有图片的分析结果整合：
- 按时间顺序组织
- 提取关键场景和变化点
- 生成视频内容摘要

## 【图片分析指导】

### 分析要点

1. **场景识别**：识别图片中的主要场景（室内/室外、办公室/工厂等）
2. **物体识别**：识别图片中的主要物体和人物
3. **文字提取**：提取图片中的文字内容（如果有）
4. **动作识别**：识别图片中的动作或状态变化
5. **时间信息**：根据文件名推断对应的时间点

### 分析格式

对每张图片进行分析时，建议使用以下格式：

```
【帧编号】vframe_0001.jpg（对应时间：00:00:10）
- 场景：办公室环境
- 主要内容：显示了一个数据表格，包含订单信息
- 关键信息：订单号、客户名称、金额等
- 备注：画面清晰，文字可读
```

## 【注意事项】

1. **ffmpeg 可用性**：确保系统已安装 ffmpeg，可通过 `ffmpeg -version` 检查
2. **文件路径**：使用绝对路径或相对于工作目录的路径
3. **存储空间**：提取大量图片可能占用较多存储空间，注意清理
4. **图片质量**：根据分析需求选择合适的图片质量（`-q:v` 参数）
5. **时间精度**：根据视频长度和需求选择合适的提取间隔
6. **错误处理**：如果 ffmpeg 命令失败，检查视频文件是否存在、格式是否支持

## 【完整示例】

```bash
# 1. 创建输出目录
mkdir -p frames

# 2. 提取视频帧（每10秒1帧，使用标准命名）
ffmpeg -i video.mp4 -vf fps=1/10 -q:v 2 frames/vframe_%04d.jpg

# 3. 查看提取的图片数量
ls frames/vframe_*.jpg | wc -l

# 4. 分析图片（逐一查看和分析）
# 使用 Read 工具读取图片文件，然后描述图片内容
```

## 【工具调用】

- **Shell 工具**：执行 ffmpeg 命令进行视频切片
- **Read 工具**：读取提取的图片文件进行分析
- **文件操作**：创建目录、管理输出文件

## 【最佳实践】

1. **先测试**：对短视频先测试命令，确认输出符合预期
2. **合理间隔**：根据视频内容和长度选择合适的提取间隔
3. **分批处理**：对于超长视频，可以分段处理
4. **及时清理**：分析完成后及时清理临时图片文件
5. **结果记录**：将分析结果记录到文档中，便于后续查阅

